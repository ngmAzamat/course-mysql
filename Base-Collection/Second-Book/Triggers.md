# ‚úÖ –ì–ª–∞–≤–∞ IV: **–¢—Ä–∏–≥–≥–µ—Ä (TRIGGER)** –≤ MySQL

## ‚ö°Ô∏è –ß—Ç–æ —Ç–∞–∫–æ–µ **–¢—Ä–∏–≥–≥–µ—Ä (TRIGGER)** –≤ MySQL?

**–¢—Ä–∏–≥–≥–µ—Ä** ‚Äî —ç—Ç–æ **–∞—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∫–æ–µ-—Ç–æ —Å–æ–±—ã—Ç–∏–µ:
–Ω–∞–ø—Ä–∏–º–µ—Ä, **–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ**, **—É–¥–∞–ª–µ–Ω–∏–µ** –∏–ª–∏ **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Å—Ç—Ä–æ–∫–∏.

> üìå –≠—Ç–æ –∫–∞–∫ —Å–∏–≥–Ω–∞–ª–∫–∞: ¬´–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ—Ç–∫—Ä—ã–ª –¥–≤–µ—Ä—å ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Ä–µ–Ω—É¬ª.

---

## üîß –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä?

–¢—Ä–∏–≥–≥–µ—Ä –º–æ–∂–Ω–æ –ø–æ–≤–µ—Å–∏—Ç—å –Ω–∞:

* `INSERT` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
* `UPDATE` ‚Äî —Å—Ç—Ä–æ–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
* `DELETE` ‚Äî —Å—Ç—Ä–æ–∫–∞ —É–¥–∞–ª–µ–Ω–∞

–ò –∑–∞–¥–∞—Ç—å –º–æ–º–µ–Ω—Ç:

* **BEFORE** ‚Äî –¥–æ –¥–µ–π—Å—Ç–≤–∏—è
* **AFTER** ‚Äî –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è

---

## üì¶ –ü—Ä–∏–º–µ—Ä: –ª–æ–≥–∏—Ä—É–µ–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –ª–æ–≥–æ–≤
CREATE TABLE user_log (
  message TEXT, -- —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç–µ–∫—Å—Ç)
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- –∫–æ–≥–¥–∞ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è)
);

-- –ú–µ–Ω—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É
DELIMITER //

-- –°–æ–∑–¥–∞—ë–º —Ç—Ä–∏–≥–≥–µ—Ä
CREATE TRIGGER after_user_insert
AFTER INSERT ON users -- —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É users
FOR EACH ROW -- –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞
BEGIN
  -- –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥: —Å–æ–µ–¥–∏–Ω—è–µ–º —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  INSERT INTO user_log(message)
  VALUES (CONCAT('–î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ', NEW.name));
END;
//

-- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –æ–±—Ä–∞—Ç–Ω–æ
DELIMITER ;
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä:

* –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–ø–æ—Å–ª–µ** `INSERT` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `user_log`

---

## üîé –ß—Ç–æ —Ç–∞–∫–æ–µ `NEW` –∏ `OLD`?

| –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤     | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
| -------------- | ------------------ | ---------------------------- |
| `NEW.column`   | `INSERT`, `UPDATE` | –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ               |
| `OLD.column`   | `UPDATE`, `DELETE` | —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è |

---

## üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã?

* –î–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
* –î–ª—è **–ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π**
* –î–ª—è **–ø–æ–¥—Å—á—ë—Ç–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å —Å—á—ë—Ç—á–∏–∫)
* –î–ª—è **–∞—É–¥–∏—Ç–∞** ‚Äî —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

---

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Å `BEFORE DELETE`, —á—Ç–æ–±—ã –Ω–µ –¥–∞—Ç—å —É–¥–∞–ª–∏—Ç—å –≤–∞–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?
